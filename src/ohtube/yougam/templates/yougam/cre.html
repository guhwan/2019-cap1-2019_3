<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
  <title>크리에이터 대시보드</title>
    {% load staticfiles %}
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  <script src="https://d3js.org/d3.v5.min.js"></script>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</head>

<style>
body {
  font-family: 'Open Sans', sans-serif;
}
section {
  width: 40%;
}
div#layout {
  text-align: center;
}
div#container {
  width: 1000px;
  height: 330px;
  margin:10px;
  background-color: #fff;
  border: 10px solid pink;
  border-radius: 100px;
}
svg {
  width: 100%;
  height: 100%;
}
.bar {
  fill: #80cbc4;
}
text {
  font-size: 13px;
  fill: gray;
  font : bold;
}
path {
  stroke: gray;
}
line {
  stroke: gray;
}
line#limit {
  stroke: #FED966;
  stroke-width: 5;
  stroke-dasharray: 3 6;
}
.grid path {
  stroke-width: 0;
}
.grid .tick line {
  stroke: gray;
  stroke-opacity: 0.2;
}
text.divergence {
  font-size: 14px;
  fill: gray;
}
text.value {
  font-size: 14px;
}
text.title {
  font-size: 22px;
  font-weight: 600;
}
text.label {
  font-size: 14px;
  font-weight: 400;
}
text.source {
  font-size: 10px;
}


/* The dots/bullets/indicators */
.dot {
  cursor: pointer;
  height: 15px;
  width: 15px;
  margin: 0 2px;
  background-color: #bbb;
  border-radius: 50%;
  display: inline-block;
  transition: background-color 0.6s ease;
}

/* Add a background color to the active dot/circle */
.active, .dot:hover {
  background-color: #717171;
}

.user img {
      width:80px;
      height:80px;
      border-radius: 50px;
      border: 2px solid pink;s
}

.user {
	float:left;
	margin-left:20px;
	margin-bottom:10px;
}

.userList {

	overflow-x : auto;
	height: 230px;
}

#linkbt {
  position: fixed;
  right:10;
  top:0px;

float:left;
margin-top:40px;
margin-left:80px;


border:1px solid #ff6268; -webkit-border-radius: 3px; -moz-border-radius: 3px;border-radius: 3px;font-size:14px;font-family:arial, helvetica, sans-serif; padding: 10px 10px 10px 10px; text-decoration:none; display:inline-block;font-weight:bold; color: #FFFFFF;
 background-color: #FF9A9E; background-image: -webkit-gradient(linear, left top, left bottom, from(#FF9A9E), to(#FAD0C4));
 background-image: -webkit-linear-gradient(top, #FF9A9E, #FAD0C4);
 background-image: -moz-linear-gradient(top, #FF9A9E, #FAD0C4);
 background-image: -ms-linear-gradient(top, #FF9A9E, #FAD0C4);
 background-image: -o-linear-gradient(top, #FF9A9E, #FAD0C4);
 background-image: linear-gradient(to bottom, #FF9A9E, #FAD0C4);filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=#FF9A9E, endColorstr=#FAD0C4);

}

#linkbt:hover{

 border:1px solid #ff343c;
 background-color: #ff676d; background-image: -webkit-gradient(linear, left top, left bottom, from(#ff676d), to(#f6ab95));
 background-image: -webkit-linear-gradient(top, #ff676d, #f6ab95);
 background-image: -moz-linear-gradient(top, #ff676d, #f6ab95);
 background-image: -ms-linear-gradient(top, #ff676d, #f6ab95);
 background-image: -o-linear-gradient(top, #ff676d, #f6ab95);
 background-image: linear-gradient(to bottom, #ff676d, #f6ab95);filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=#ff676d, endColorstr=#f6ab95);

.homeBT {

}

</style>

<body>
  <div id='layout'>
    <!-- <h2>Bar chart example</h2> -->
    <div style="background-color:blue; ">  <img src="{% static "img/title.png" %}" class="media-object" style="float:left;width:400px;margin-left:50px;margin-top: 10px;"></div>
    <div>
		<p style ="padding-top:40px;text-align: left; float:left; font-weight: bold; font-size:16px;">&nbsp&nbsp{{video_title}} 의 분석 결과 입니다.</p>
		<button id="linkbt" onclick="location.href='/yougam/{{video_id}}/user'">사용자 분석으로 이동</button>
	</div>





    <div style="clear:left;"class="row">

		            <!--            side bar start  -->

                    <link rel="stylesheet" href="{% static 'css/sideBar.css' %}">


                    <div style="background-color:#414040; color:white; font-size:10px; width: 60px; height:30px; position: fixed; right:30px; bottom: 100px; z-index: 1; border-radius: 30px; padding-top:8px; font-weight: bold">
                      HOME
                    </div>

                    <div class="homeBT">
                      <img onclick="location.href='https://kmu-yougam.tk/yougam/'" src="{% static "img/home.png" %}" style="height:100px; width:100px; position: fixed; right:10px; bottom: 0; z-index: 1;">
                    </div>

                    <div class="share"><img src="{% static "img/share.png" %}"></div>
                    <div class="side-bar">


                            <div class="button2" style="background-color:#3b5998;">
                              <div class="button2-content" style="content: 'facebook'" onclick="toSNS('facebook','유튜브감성분석 - 유감')">
                                  <img src="{% static "img/facebook.png" %}">
                              </div>
                            </div>

                            <div class="button2" style="background-color:#00c300;">
                              <div class="button3-content" style="content: 'naver'" onclick="toSNS('line','유튜브감성분석 - 유감')">

                                        <img src="{% static "img/line.png" %}">

                              </div>
                            </div>


                            <div class="button2" style="background-color:#00acee">
                              <div class="button5-content" style="content: 'twitter'" onclick="toSNS('twitter','유튜브감성분석 - 유감')" >
                                  <img src="{% static "img/twitter.png" %}">
                              </div>
                            </div>


                    </div>

            <script>


             function toSNS(sns, strTitle) {


                    strURL = window.location.href;
                    var snsArray = new Array();
                    var strMsg = strTitle + " " + strURL;
                    console.log(strMsg);

                    var image = "{% static "img/kakao.png" %}";


                     snsArray['twitter'] = "http://twitter.com/home?status=" + encodeURIComponent(strTitle) + ' ' + encodeURIComponent(strURL);
                    snsArray['line'] = "http://line.me/R/msg/text/?" + encodeURIComponent(strTitle) + " " + encodeURIComponent(strURL);
                    snsArray['facebook'] = "http://www.facebook.com/share.php?u=" + encodeURIComponent(strURL);
                    snsArray['blog'] = "http://blog.naver.com/openapi/share?url=" + encodeURIComponent(strURL) + "&title=" + encodeURIComponent(strTitle);

                            window.open(snsArray[sns]);
                }

            </script>

            <!--            side bar end -->

      <div style="margin-left:130px;"class="col-md-5" id='container'>
		  <div style="width:400px;margin-left: 80px;text-align: center;" class="alert alert-danger alert-dismissible" id="myAlert">
		    			<strong style="padding-left:35px;"> 시청자들의 웹캠 감성분석 평균 결과</strong>
		  </div>
          <svg></svg>
      </div>

      <div class="col-md-5" id='container'>
		  <div style="width:400px;margin-left: 80px;text-align: center;" class="alert alert-danger alert-dismissible" id="myAlert">
		    			<strong style="padding-left:35px;"> 영상을 제공한 시청자들</strong>
		  </div>


		  <div class="userList">



					{% for i in capture %}

			  			<div class="user">

								 <img src="/yougam/media/{{i.capture_path}}">

							<br>
							{{ i.upload_date|date:"a f"}}

						</div>

					{% endfor %}


		  </div>

      </div>

    </div>


    <div class="row">
      <div style="margin-left:130px;" class="col-md-5" id='container'>
		      	  <div style="width:400px;margin-left: 80px;text-align: center;" class="alert alert-danger alert-dismissible" id="myAlert">
		    			<strong style="padding-left:35px;">댓글 긍정 중립 부정 분포 & 인기 댓글 TOP3</strong>
		  		  </div>
			  		<section style="float:left;">
                    <canvas style="margin-left:30px; "id="myChart" width="100" height="95"></canvas>
                    </section>

                    <script src="{% static 'chart_js/Chart.js' %}"></script>
                            <script type="text/javascript">
                      var data = {
                              labels:  ['긍정', '중립', '부정'],
                        datasets: [{
                                label: 'sentiment',
                                backgroundColor: ["#ec6e85","#f7cf6b","#57a0e5"],
                                data: [{{num_pos}},{{num_net}},{{num_neg}}],
                              }]
                    };

                    Chart.pluginService.register({
                      beforeDraw: function(chart) {
                        var width = chart.chart.width,
                            height = chart.chart.height,
                            ctx = chart.chart.ctx,
                            type = chart.config.type;

                        if (type == 'doughnut')
                        {
                          var percent = Math.round((chart.config.data.datasets[0].data[0] * 100) /
                                        (chart.config.data.datasets[0].data[0] +
                                        chart.config.data.datasets[0].data[1]+
                                         chart.config.data.datasets[0].data[2]));
                          var oldFill = ctx.fillStyle;
                          var fontSize = ((height - chart.chartArea.top) / 100).toFixed(2);
                          
                          ctx.restore();
                          ctx.font = fontSize + "em sans-serif";
                          ctx.textBaseline = "middle"

                          var text = percent + "%",
                              textX = Math.round((width - ctx.measureText(text).width) / 2),
                              textY = (height + chart.chartArea.top) / 2;
                          
                          ctx.fillStyle = chart.config.data.datasets[0].backgroundColor[0];
                          ctx.fillText(text, textX, textY);
                          ctx.fillStyle = oldFill;
                          ctx.save();
                        }
                      }
                    });

                    var myChart = new Chart(document.getElementById('myChart'), {
                      type: 'doughnut',
                      data: data,
                      options: {
                        responsive: true,
                        legend: {
                          display: true
                        }
                      }
                    });
                    </script>
					<div class="mySlides" style="height:170px;">
						<div id = "first"><span style="background-color: #fe8a71; color:white; padding:3px;"><strong>인기 1위</strong></span>
							{% if no1.label == 0 %}
								<span style="padding:3px; background-color:#f75175; color:white;"><strong>부정</strong></span>
								<span style="padding:3px;background-color: #98c8ea; color:#261b6d"><strong>UP&nbsp👍{{no1.like}}</strong></span>
							{% else %}
		                    {% endif %}
		                    {% if no1.label == 2 %}
		                    	<span style="padding:3px; background-color:#72bfb3;color:white;"><strong>긍정</strong></span>
								<span style="padding:3px;background-color: #98c8ea; color:#261b6d"><strong>UP&nbsp👍{{no1.like}}</strong></span>
							{% else %}
		                    {% endif %}
		                    {% if no1.label == 1 %}
		                    	<span style="padding:3px; background-color:#905cc4;color:white;"><strong>중립</strong></span>
								<span style="padding:3px;background-color: #98c8ea; color:#261b6d"><strong>UP&nbsp👍{{no1.like}}</strong></span>

 							{% else %}
		                    {% endif %}
	                    	<p style="margin-top: 10px;">{{no1.cmt}}</p>

						</div>
					</div>

					<div class="mySlides" style="height:170px;">


						<div id = "second"><span style="background-color: #fe8a71; color:white; padding:3px;"><strong>인기 2위</strong></span>
							{% if no2.label == 0 %}
								<span style="padding:3px; background-color:#f75175; color:white;"><strong>부정</strong></span>
								<span style="padding:3px;background-color: #98c8ea; color:#261b6d"><strong>UP&nbsp👍{{no2.like}}</strong></span>

							{% else %}
		                    {% endif %}
		                    {% if no2.label == 2 %}

								<span style="padding:3px; background-color:#72bfb3;color:white;"><strong>긍정</strong></span>
								<span style="padding:3px;background-color: #98c8ea; color:#261b6d"><strong>UP&nbsp👍{{no2.like}}</strong></span>

							{% else %}
		                    {% endif %}
		                    {% if no2.label == 1 %}

								<span style="padding:3px; background-color:#905cc4;color:white;"><strong>중립</strong></span>
								<span style="padding:3px;background-color: #98c8ea; color:#261b6d"><strong>UP&nbsp👍{{no2.like}}</strong></span>

							{% else %}
		                    {% endif %}
	                    	<p style="margin-top: 10px;">{{no2.cmt}}</p>

						</div>


					</div>

					<div class="mySlides" style="height:170px;">

						<div id = "third" ><span style="background-color: #fe8a71; color:white; padding:3px;"><strong>인기 3위</strong></span>
							{% if no3.label == 0 %}
								<span style="padding:3px; background-color:#f75175; color:white;"><strong>부정</strong></span>
								<span style="padding:3px;background-color: #98c8ea; color:#261b6d"><strong>UP&nbsp👍{{no3.like}}</strong></span>
							{% else %}
		                    {% endif %}
		                    {% if no3.label == 2 %}

								<span style="padding:3px; background-color:#72bfb3;color:white;"><strong>긍정</strong></span>
								<span style="padding:3px;background-color: #98c8ea; color:#261b6d"><strong>UP&nbsp👍{{no3.like}}</strong></span>

							{% else %}
		                    {% endif %}
		                    {% if no3.label == 1 %}


								<span style="padding:3px; background-color:#905cc4;color:white;"><strong>중립</strong></span>
								<span style="padding:3px;background-color: #98c8ea; color:#261b6d"><strong>UP&nbsp👍{{no3.like}}</strong></span>

							{% else %}
		                    {% endif %}
		                    	<p style="margin-top: 10px;">{{no3.cmt}}</p>
		                </div>
					</div>


				<div class="dot-container">
				  <span class="dot" onclick="currentSlide(1)"></span>
				  <span class="dot" onclick="currentSlide(2)"></span>
				  <span class="dot" onclick="currentSlide(3)"></span>
				</div>


      </div>

      <div class="col-md-5" id='container'>
            <div style="width:400px;margin-left: 80px;text-align: center;" class="alert alert-danger alert-dismissible" id="myAlert">
		    			<strong style="padding-left:50px;">전체 댓글 감성 분포도 </strong>
		  		  </div>
            <div>
            <section>
            <canvas id="sc6" width="200" height="200" style="margin-left:15px; margin-top:20px; margin-left:170px;"></canvas>
            </section>
            <script>var ans = JSON.parse("{{ count }}");
            </script>



            <script>
              var sc6 = document.getElementById('sc6');
              console.log(ans)
              console.log(window.location.href);

              var sentiment6 = new Chart(sc6, {
                type: 'radar',
                data: {
                    labels:  ['중립', '행복', '슬픔', '놀람', '화남', '두려움'],
                    datasets: [{
                      label: 'sentiment',
                      backgroundColor: "rgba(200,0,0,0.2)",
                      data: ans
                    }]
                }
            });
            </script>
          </div>
      </div>

    </div>




  </div>

</body>



    <script>


    const colorData = ["#A64E6E", "#F2BB77", "#F2A25C", "#FFE2DF", "#FFC001", "#FF6F61", "#F8A39D", "#81894E"];
    const sample = {{ json }}
    const svg = d3.select('svg');
    const svgContainer = d3.select('#container');
    const margin = 10;
    const width = 560;
    const height = 200;

    const chart = svg.append('g')
      .attr('transform', `translate(${margin}, ${margin})`);
    const xScale = d3.scaleBand()
      .range([0, width])
      .domain(sample.map((s) => s.label))
      .padding(0.4)
    const yScale = d3.scaleLinear()
      .range([height, 0])
      .domain([0, 1]);
    // vertical grid lines
    // const makeXLines = () => d3.axisBottom()
    //   .scale(xScale)
    const makeYLines = () => d3.axisLeft()
      .scale(yScale)
    chart.append('g')
      .attr('transform', `translate(0, ${height})`)
      .call(d3.axisBottom(xScale));
    chart.append('g')
      .call(d3.axisLeft(yScale));
    chart.append('g')
      .attr('class', 'grid')
      .call(makeYLines()
        .tickSize(-width, 0, 0)
        .tickFormat('')
      )
    const barGroups = chart.selectAll()
      .data(sample)
      .enter()
      .append('g')
    barGroups
      .append('rect')
      .attr('class', 'bar')
      .attr('x', (g) => xScale(g.label))
      .attr('y', (g) => yScale(g.value))
      .attr('height', (g) => height - yScale(g.value))
      .attr('width', xScale.bandwidth())
      .style("fill", function(d, i) {
        return colorData[i];
        })
      .on('mouseenter', function (actual, i) {
        d3.selectAll('.value')
          .attr('opacity', 0)
        d3.select(this)
          .transition()
          .duration(300)
          .attr('opacity', 0.6)
          .attr('x', (a) => xScale(a.label) - 5)
          .attr('width', xScale.bandwidth() + 10)
        const y = yScale(actual.value)
        line = chart.append('line')
          .attr('id', 'limit')
          .attr('x1', 0)
          .attr('y1', y)
          .attr('x2', width)
          .attr('y2', y)
        barGroups.append('text')
          .attr('class', 'divergence')
          .attr('x', (a) => xScale(a.label) + xScale.bandwidth() / 2)
          .attr('y', (a) => yScale(a.value) + 30)
          .attr('fill', 'white')
          .style('fill', 'white')
          .attr('font-weight', 'bold')
          .attr('text-anchor', 'middle')
          .text((a, idx) => {
            const divergence = (a.value - actual.value).toFixed(1)
            let text = ''
            if (divergence > 0) text += '+'
            text += `${divergence}%`
            return idx !== i ? text : '';
          })
      })
      .on('mouseleave', function () {
        d3.selectAll('.value')
          .attr('opacity', 1)
        d3.select(this)
          .transition()
          .duration(300)
          .attr('opacity', 1)
          .attr('x', (a) => xScale(a.label))
          .attr('width', xScale.bandwidth())
        chart.selectAll('#limit').remove()
        chart.selectAll('.divergence').remove()
      })
    barGroups
      .append('text')
      .attr('class', 'value')
      .attr('x', (a) => xScale(a.label) + xScale.bandwidth() / 2)
      .attr('y', (a) => yScale(a.value) - 15)
      .attr('text-anchor', 'middle')
      .text((a) => `${Math.round(a.value*100)}%`)
      .style('font-weight', 'bold')
      .style('border','solid 1px black')

    svg.append('text')
      .attr('class', 'source')
      .attr('x', width - margin / 2)
      .attr('y', height + margin * 1.7)
      .attr('text-anchor', 'start')


    </script>
<script>
var slideIndex = 1;
showSlides(slideIndex);

function currentSlide(n) {
  showSlides(slideIndex = n);
}

function showSlides(n) {
  var i;
  var slides = document.getElementsByClassName("mySlides");
  var dots = document.getElementsByClassName("dot");
  if (n > slides.length) {slideIndex = 1}
  if (n < 1) {slideIndex = slides.length}
  for (i = 0; i < slides.length; i++) {
      slides[i].style.display = "none";
  }
  for (i = 0; i < dots.length; i++) {
      dots[i].className = dots[i].className.replace(" active", "");
  }
  slides[slideIndex-1].style.display = "block";
  dots[slideIndex-1].className += " active";
}
</script>

</html>

